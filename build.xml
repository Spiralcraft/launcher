<project name="spiralcraft-launcher" basedir="." default="build">

  <!-- Copy and customize the following local settings into build-local.xml 
  -->
  
  <!-- 
    <project name="build-local">
      <property name="launch4j.dir" value=" PATH-TO-LAUNCH4J "/>
    </project>  
  -->

  <property name="classpath" 
  	 value="lib/spiralcraft.jar:lib/spiralcraft-core.jar"
  />
  <property name="module" value="launcher"/>
  <property name="buildVersion" value="0.3.1-dev"/>
  

  <import file="../../build/build-common.xml"/>
	
  <target name="clean" depends="build-common.clean">
    <mkdir dir="main-out"/>
    <delete>
      <fileset dir="main-out" includes="**/*"/>
    </delete>
  </target>

  <target name="compile" depends="jar-main,build-common.compile,native"/>
	
  <target name="compile-main">
    <echo message= "build-main: ${build.name}"/>
    <javac 
      srcdir="main-source" 
      destdir="main-out"
      debug="true"
      deprecation="true"
      compiler="modern"
      fork="true"
      >
      <compilerarg value="-Xlint"/>
    </javac>
    
    <copy toDir="main-out"
      preservelastmodified="true"
      failonerror="true"
      >
      <fileset
        dir="main-source"
        excludes="**/*.class,**/*.java"
        >
        
      </fileset>
    </copy>
    
    <propertyfile file="main-out/build-${build.name}"/>
  </target>

  <target name="jar-main" depends="compile-main">
    <echo message= "jar-main: ${build.name}"/>
    <jar 
      destfile="lib/spiralcraft.jar" 
      basedir="main-out"
      level="9"
      >
      <Manifest>
        <attribute name="Main-Class" value="spiralcraft.main.Spiralcraft"/>   
      </Manifest>
      <include name="build.name.local"/>
      <include name="spiralcraft/**/*.class"/>
      <include name="spiralcraft/**/*.xml"/>
      <include name="spiralcraft/**/*.tgl"/>
      <include name="spiralcraft/**/*.webui"/>
      <include name="spiralcraft/**/*.ghtml"/>
      <include name="spiralcraft/**/*.properties"/>
    </jar>
       
  </target>

  <condition property="isLaunch4j">
    <and>
      <available file="${launch4j.dir}"/>
      <available file="native-source"/>
    </and>
  </condition>


  <target name="native" if="isLaunch4j" depends="native-console"/>
	
  <target name="native-console" >
    <echo>Native Windows wrapper</echo>
    <launch4j>
      <config
        headerType="console"
        outfile="lib/spiralcraft.exe"
        jarPath="spiralcraft.jar"
        icon="native-source/favicon.ico"
        dontWrapJar="true"
        >
        <jre
          minVersion="1.6.0"
          jdkPreference="preferJre"
          >
        </jre>
      </config>
    </launch4j>
  </target>
  
  <target name="smoke">
    <java 
      jar="lib/spiralcraft.jar"
      fork="true"
      >
      <arg value="-debug"/>
    </java>
 
  </target>
		

  
  
</project>
